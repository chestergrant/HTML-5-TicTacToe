<!DOCTYPE>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <title>HTML 5 TicTacToe</title>

        <link rel=stylesheet href=style.css type=text/css>

        <script type="text/javascript"><!--
            // Get the canvas element.
              var context, elem,tempContext, tempCanvas;
              var y_off = 10;
              var scr_height = 400;
              var scr_width = 660;
              var lineWidth =10;
              var lineHeight = scr_height-2*y_off;
              var x_off = (scr_width - lineHeight)/2;
              var space = lineHeight/3;
              var lastHover =-1;
              var turn = 1;
              var intel=Math.floor(Math.random()*2);
              var gameBoard = new Array(3);
              var msgBox;
              var start = false;
              var firstPlay = true;
            window.addEventListener('load', function () {
              
              function init(){
                  elem = document.getElementById('myCanvas');
                  msgBox = document.getElementById('status');
                  if (!elem || !elem.getContext) {
                    return;
                  }

                  // Get the canvas 2d context.
                  context = elem.getContext('2d');
                  if (!context) {                      
                    return;
                  }
                  //TO DO,  add your application code
                  var container = elem.parentNode;
                  var tempCanvas = document.createElement('canvas');
                  if(!tempCanvas||!tempCanvas.getContext){
                      return;
                  }
                  tempCanvas.id ='tempView';
                  tempCanvas.width = elem.width;
                  tempCanvas.height = elem.height;
                  container.appendChild(tempCanvas);
                  tempContext = tempCanvas.getContext('2d');
                   restartGame();
                   
                   elem.addEventListener('click', mouseclick, false);
                   elem.addEventListener('mousemove', mousehover, false);
                   tempCanvas.addEventListener('click', mouseclick, false);
                   tempCanvas.addEventListener('mousemove', mousehover, false);
                   //document.addEventListener('findload', function(event) { restartGame(); }, false);
                  }
                
               init();
            }, false);
            function reset(){
                    for(var i = 0; i< 3;i++){
                        gameBoard[i] = new Array(3);
                        gameBoard[i][0]=-1;
                        gameBoard[i][1]=-1;
                        gameBoard[i][2]=-1;
                    }
                }
                function msg(theMsg){
                    var str='<span class="green">Status:&nbsp;</span>';
                    msgBox.innerHTML=str+' '+theMsg;
                }
                function xPos(pos){
                    return (pos-1)%3;
                }
                function yPos(pos){
                    return Math.floor((pos-1)/3);
                }

                function mousehover(ev){
                   
                   if((turn == getOpponent(intel))&&(start)){
                    var x,y;
                    // Get the mouse position relative to the canvas element.
                    if (ev.layerX || ev.layerX == 0) { // Firefox
                      x = ev.layerX;
                      y = ev.layerY;
                    } else if (ev.offsetX || ev.offsetX == 0) { // Opera
                      x = ev.offsetX;
                      y = ev.offsetY;
                    }
                    //x -= 200;
                    //y -= 20;
                    var pos = position(x,y);
                    //alert(""+pos);
                    if(pos != -1){
                        if(lastHover != pos){
                            if(gameBoard[yPos(pos)][xPos(pos)]==-1){
                                drawHighlight(pos);
                                lastHover = pos;
                            }
                        }
                    }
                   }
                }

                function drawHighlight(pos){

                    var xBegin = getCorr(pos,1);
                    var yBegin = getCorr(pos, 2);
                    var xEnd = getCorr(pos,3);
                    var yEnd = getCorr(pos,4);
                    tempContext.fillStyle   = '#7bc00a';
                    tempContext.strokeStyle = '#7bc00a';

                    tempContext.clearRect(0, 0, 660, 400);
                    tempContext.fillStyle   = 'rgba(123,192,10,0.5)';
                    //alert("in2");
                    tempContext.strokeStyle = '#7bc00a';
                    tempContext.lineWidth   = 1;
                    //alert(xBegin+", "+yBegin);
                    tempContext.fillRect(xBegin,yBegin,xEnd-xBegin, yEnd-yBegin );

                }
                function mouseclick(ev){

                    var x,y;
                    // Get the mouse position relative to the canvas element.
                    if (ev.layerX || ev.layerX == 0) { // Firefox
                      x = ev.layerX;
                      y = ev.layerY;
                    } else if (ev.offsetX || ev.offsetX == 0) { // Opera
                      x = ev.offsetX;
                      y = ev.offsetY;
                    }
                    //x -= 200;
                    //y -= 20;
                    //lert("back");
                    //alert(position(x,y));

                    if((start)&&(turn  == getOpponent(intel))){
                        var pos = position(x,y);
                        //alert(""+pos);

                        if(pos != -1){
                            play(pos);
                        }
                    }

                }
                function play(pos){
                    //if(pos==5)alert("hehe0");
                   var x = xPos(pos);
                   var y = yPos(pos);
                    //if(pos==5)alert("hehe");
                   if(gameBoard[y][x]==-1){
                       gameBoard[y][x] = turn;
                       firstPlay = false;
                       tempContext.clearRect(0, 0, elem.width, elem.height);

                    if(turn == 1){
                        turn = 0;
                        drawX(pos);
                    }else{
                        turn =1;
                        drawO(pos);

                    }
                     //if(pos==5)alert("hehe8");
                   if(gameOver(gameBoard)){
                      msg(whoWon());
                      start = false;
                      return;
                   }
                    //if(pos==5)alert("hehe9");
                   computerPlay();
                    //if(pos==5)alert("hehe");
                   /*if(turn == AI){
                       msg("Computer turns to play");
                       var inp= minimax(gameBoard, AI);
                       //sleep(4000);
                       setTimeout(function(){play(inp);},1000);
                       //sleep(4000);

                     }else{
                       msg("Your turn to play");
                     }*/
                   }

                }
                function whoWon(){
                    if(checkWin(gameBoard,1)){
			if(getOpponent(intel)==1){
                            return "Congrats you won!!!";
                        }
                        return "Sorry the computer won.";
                    }
                    if(checkWin(gameBoard,0)){
			if(getOpponent(intel)==0){
                            return "Congrats you won!!!";
                        }
                        return "Sorry the computer won.";
                    }

                    return "The Game was Drawn";
                }
                function getOpponent(you){
                    if(you == 1){
                        return 0;
                    }
                    return 1;
                }
                function corrToPos(ix,jy){
                    return (ix*3)+(jy+1);
                }


                function copyBoard(board){
                    var newBoard = new Array(board.length);
                    for(var k = 0; k <board.length; k++){
                        newBoard[k] = new Array(board.length);
                        for(var l = 0; l < board.length; l++){
                            newBoard[k][l] = board[k][l];
                        }
                    }
                    return newBoard;
                }
                function maxEvaluation(board,depth){
                    var ans = new Array(2);
                    ans[0] = 0;
                    ans[1] = 0;
                    if(checkWin(board,1)){
                            ans[1] = 2*(10-depth);
                            return ans;
                    }
                    if(checkWin(board,0)){
                            ans[1] = -2*(10-depth);
                            return ans;
                    }
                    return ans;
                }
                function maxMove(board, piece, depth){
                    //alert("haaa");
                    var bestMove = new Array(2);
                    var newBoard = copyBoard(board);
                    if(gameOver(board)){
                            //alert(depth+'');
                            return maxEvaluation(board, depth);
                    }
                    var first = 0;
                    for(var i = 0; i< board.length; i++){
                            for(var j=0; j<board.length; j++){
                                    if(newBoard[i][j] == -1){
                                            newBoard[i][j] = piece;
                                            var value = minMove(newBoard, getOpponent(piece),depth+1);
                                            if(first==0){
                                                    bestMove[0] = corrToPos(i,j);
                                                    bestMove[1] = value[1];
                                                    first++;
                                            }
                                            if(bestMove[1] < value[1]){
                                                    bestMove[0] = corrToPos(i,j);
                                                    bestMove[1] = value[1];
                                                    //alert(value+" the best");
                                            }
                                            value= null;
                                            newBoard[i][j] = -1;
                                    }
                            }
                    }
                    first=null;
                    newBoard = null;
                    return bestMove;
                }
                function minMove(board, piece, depth){
                    var bestMove = new Array(2);
                    var newBoard = copyBoard(board);

                    if(gameOver(board)){
                            //alert(depth+'');
                            return maxEvaluation(board, depth);
                    }
                    var first = 0;
                    for(var i = 0; i< board.length; i++){
                            for(var j=0; j<board.length; j++){
                                    if(newBoard[i][j] == -1){
                                            newBoard[i][j] = piece;
                                            var value = maxMove(newBoard, getOpponent(piece),depth+1);
                                            //System.out.println(value);
                                            if(first==0){
                                                    bestMove[0] = corrToPos(i,j);
                                                    bestMove[1] = value[1];
                                                    first++;
                                            }
                                            if(bestMove[1] > value[1]){
                                                    bestMove[0] = corrToPos(i,j);
                                                    bestMove[1] = value[1];
                                            }
                                            value = null;
                                            newBoard[i][j] = -1;
                                    }
                            }
                    }
                    first=null;
                    newBoard = null;
                    return bestMove;
                }
                function minimax(board,piece){
                    var ans = new Array(2);
                    //alert("we are in");

                    if(piece == 1){
                             ans = maxMove(board, piece,0);
                            return ans[0];
                    }else{
                            ans = minMove(board, piece,0);
                            return ans[0];
                    }
                   /* simply AI
                    * for(i =0; i<3; i++){
                        for(j =0; j<3; j++){
                            if(gameBoard[i][j]==-1){
                                return corrToPos(i,j);
                            }
                        }
                    }

                    return 1;*/
                }
                function gameOver(board){
                    if(checkWin(board,1)){
			return true;
                    }
                    if(checkWin(board,0)){
			return true;
                    }
                    if((checkDraw(board,1))&&(checkDraw(board,0))){
			return true;
                    }

                    return false;
                }
                function checkDraw(board, AI){
                    var opp = getOpponent(AI);
			var draw = false;
			for(var i=0; i<board.length;i++){
				if(((board[i][0]!=opp)&&(board[i][1]!=opp)&&(board[i][2]!=opp))&&( (board[i][0]!=opp)||(board[i][1]!=opp)||(board[i][2]!=opp) )){
					//System.out.println("Check Draw 1 "+ AI);
					return false;
				}
				if(((board[0][i]!=opp)&&(board[1][i]!=opp)&&(board[2][i]!=opp))&&( (board[0][i]!=opp)||(board[1][i]!=opp)||(board[2][i]!=opp) ) ){
					//System.out.println("Check Draw 2 "+ AI);
					return false;
				}

			}
			if(( (board[0][0]!=opp)&&(board[1][1]!=opp)&&(board[2][2]!=opp)) &&( (board[0][0]!=opp)||(board[1][1]!=opp)||(board[2][2]!=opp) ) ){
				//System.out.println("Check Draw 3 "+ AI);
				return false;
			}
			if(((board[0][2]!=opp)&&(board[1][1]!=opp)&&(board[2][0]!=opp))&&((board[0][2]!=opp)||(board[1][1]!=opp)||(board[2][0]!=opp)) ){
				//System.out.println("Check Draw 4 "+ AI);
				return false;
			}
	        //System.out.println("Check Draw 5 "+ AI);
			return true;
                }
                function checkWin(board, AI){
                    for(var i=0; i< board.length;i++){
                            if((board[i][0]==AI)&&(board[i][1]==AI)&&(board[i][2]==AI)){
                                    //System.out.println("win 1");
                                    return true;
                            }
                            if((board[0][i]==AI)&&(board[1][i]==AI)&&(board[2][i]==AI)){
                                    //System.out.println("win 2");
                                    return true;
                            }

                    }
                    if((board[0][0]==AI)&&(board[1][1]==AI)&&(board[2][2]==AI)){
                                //System.out.println("win 3");
                                    return true;
                            }
                            if((board[0][2]==AI)&&(board[1][1]==AI)&&(board[2][0]==AI)){
                                    //System.out.println("win 4");
                                    return true;
                            }

                    return false;
                }
                function restartGame(){
                    start= true;
                    tempContext.clearRect(0, 0, elem.width, elem.height);
                    context.clearRect(0, 0, elem.width, elem.height);
                    intel=Math.floor(Math.random()*2);
                    drawGrid();
                    reset();
                    computerPlay();
                    
                }
                function computerPlay(){
                    //alert("Got called");
                    if(start){
                      if(turn == intel){
                           msg("Computer turns to play");
                           if(firstPlay){play(5); return;}
                           var ans = minimax(gameBoard,intel);
                           play(ans);

                        }else{
                           msg("Your turn to play");
                        }
                    }
                }
                function drawO(pos){
                    var xBegin = getCorr(pos,1);
                    var yBegin = getCorr(pos, 2);
                    var xEnd = getCorr(pos,3);
                    var yEnd = getCorr(pos,4);
                    var buffer = 20;
                    var r = (xEnd - xBegin)/2;
                    r = r- buffer;
                    var x_cen = xBegin+ ((xEnd - xBegin)/2);
                    var y_cen = yBegin+ ((yEnd-yBegin)/2);
                    var buffer =10;
                    r -= buffer;
                    context.lineWidth = lineWidth;
                    context.fillStyle   = '#FFFFFF';
                    context.strokeStyle = '#FFFFFF';
                    context.beginPath();
                    context.arc(x_cen,y_cen,r,0,Math.PI*2,true);
                    context.closePath();
                    context.stroke();

                }
                function drawX(pos){


                    var buffer = 20;
                    var xBegin = getCorr(pos,1);
                    var yBegin = getCorr(pos, 2);
                    var xEnd = getCorr(pos,3);
                    var yEnd = getCorr(pos,4);
                    var sin45 = 0.850903525;
                    var o = sin45* lineWidth;
                    //draw one side of the x
                    context.lineWidth = lineWidth;
                    context.fillStyle   = '#FFFFFF';
                    context.strokeStyle = '#FFFFFF';
                    context.beginPath();
                    context.moveTo(xBegin+buffer,yBegin+buffer);
                    context.lineTo(xEnd-buffer,yEnd-buffer);

                    //draw other side of x

                    context.moveTo(xBegin+buffer,yEnd-buffer);
                    //context.lineTo(xBegin+buffer+o,yEnd-buffer);
                    //context.lineTo(xEnd-buffer,yBegin+buffer+o);
                    context.lineTo(xEnd-buffer,yBegin+buffer);
                    //context.lineTo(xBegin+buffer,yEnd-buffer-o);
                    context.stroke();
                    context.closePath();



                }
                function getCorr(pos, type){
                    var start_x = (pos-1)%3;
                    var start_y = ((pos-(start_x +1))/3);
                    //alert(start_x+" "+start_y);
                    var addCorr = space;//+lineWidth;

                    var xBegin = (addCorr *start_x) + x_off;
                    var xEnd = xBegin+space;
                    var yBegin = (addCorr *start_y) + y_off;
                    var yEnd = yBegin+space;
                    if(type==1){
                        return xBegin;
                    }else if(type == 2){
                        return yBegin;
                    }else if(type == 3){
                        return xEnd;
                    }else{
                        return yEnd;
                    }
                }
                function position(x,y){
                    for(var i=1; i<10;i++){
                        if(checkBox(i,x,y)){
                            return i;
                        }

                    }
                    return -1;
                }
                function checkBox(i, x, y){


                    var xBegin = getCorr(i,1);
                    var yBegin = getCorr(i,2);
                    var xEnd = getCorr(i,3);
                    var yEnd = getCorr(i,4);
                    /*alert("checking: "+i+" x: "+x+" y: "+y+" ("+xBegin+" , "+yBegin+")"+" ("+xEnd+" , "+yEnd+")");
                    if(x>=xBegin){
                        alert("Part: "+x+">="+xBegin);
                         if(x<=xEnd){
                             alert("Part: "+x+"<="+xEnd);
                         }else{
                             alert("Part: "+x+">"+xEnd);
                         }
                    }else{
                        alert("Part: "+x+"<"+xBegin);
                        if(x<=xEnd){
                             alert("Part: "+x+"<="+xEnd);
                         }else{
                             alert("Part: "+x+">"+xEnd);
                         }
                    }*/
                    if((x>=xBegin)&&(x<=xEnd)){
                        if((y>=yBegin)&&(y<=yEnd)){
                            return true;
                        }
                    }

                    return false;
                }
                function drawGrid(){
                  context.fillStyle   = '#7bc00a';
                  context.strokeStyle = '#7bc00a';
                  context.lineWidth   = 1;
                  context.fillRect(x_off+space,y_off,lineWidth, lineHeight );
                  context.fillRect(x_off+2*space,y_off,lineWidth, lineHeight );
                  context.fillRect(x_off,y_off+(lineHeight/3),lineHeight, lineWidth );
                  context.fillRect(x_off,y_off+2*(lineHeight/3),lineHeight, lineWidth );

                }
                //window.setInterval(function(){computerPlay();},1000);
            //window.setTimeout(function(){restartGame();},1000);
                // --></script>

    </head>
    <body>
        <header>
            
        </header>
                   <div id="sec1">
                    
                        
                            <canvas id="myCanvas" width="660" height="400">
                                Your browser does not have support for Canvas.
                            </canvas>
                        
                            <div id="status"><span class="green">Status:&nbsp;</span> Your Turn</div>
                    
                    </div>
                    <div id="start"><center><a href="" class="btn">New Game</a>
</center>
                    </div>
                <aside>
                </aside>
        <footer>
        </footer>
            
            
    </body>
</html>
