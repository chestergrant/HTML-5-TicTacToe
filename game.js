var d,f,g,i=10,j=10,k=400-2*i,l=(660-k)/2,m=k/3,n=-1,o=1,p=Math.floor(Math.random()*2),q=Array(3),r,t=false,u=true,v=new Worker("commons.js");v.onmessage=function(a){w(a.data)};v.onerror=function(){alert("An error has occur!")}; window.addEventListener("load",function(){(function(){f=document.getElementById("myCanvas");r=document.getElementById("status");if(!f||!f.getContext)alert("Error can't get context");else if(d=f.getContext("2d")){var a=f.parentNode,b=document.createElement("canvas");if(b&&b.getContext){b.id="tempView";b.width=f.width;b.height=f.height;a.appendChild(b);g=b.getContext("2d");t=true;g.clearRect(0,0,f.width,f.height);d.clearRect(0,0,f.width,f.height);p=Math.floor(Math.random()*2);d.fillStyle="#7bc00a"; d.strokeStyle="#7bc00a";d.lineWidth=1;d.fillRect(l+m,i,j,k);d.fillRect(l+2*m,i,j,k);d.fillRect(l,i+k/3,k,j);d.fillRect(l,i+2*(k/3),k,j);for(a=0;a<3;a++){q[a]=Array(3);q[a][0]=-1;q[a][1]=-1;q[a][2]=-1}x();f.addEventListener("click",y,false);f.addEventListener("mousemove",z,false);b.addEventListener("click",y,false);b.addEventListener("mousemove",z,false)}}else alert("Error can't get context")})()},false); function A(a,b){for(var c=Array(4),e=0;e<3;e++){c[e]=Array(3);for(var h=0;h<3;h++)c[e][h]=a[e][h]}c[3]=Array(3);c[3][0]=b;return c}function B(a){r.innerHTML='<span class="green">Status:&nbsp;</span> '+a} function z(a){if(o==getOpponent(p)&&t){var b,c;if(a.layerX||a.layerX==0){b=a.layerX;c=a.layerY}else if(a.offsetX||a.offsetX==0){b=a.offsetX;c=a.offsetY}a=C(b,c);if(a!=-1)if(n!=a)if(q[Math.floor((a-1)/3)][(a-1)%3]==-1){b=D(a,1);c=D(a,2);var e=D(a,3),h=D(a,4);g.fillStyle="#7bc00a";g.strokeStyle="#7bc00a";g.clearRect(0,0,660,400);g.fillStyle="rgba(123,192,10,0.5)";g.strokeStyle="#7bc00a";g.lineWidth=1;g.fillRect(b,c,e-b,h-c);n=a}}} function y(a){var b,c;if(a.layerX||a.layerX==0){b=a.layerX;c=a.layerY}else if(a.offsetX||a.offsetX==0){b=a.offsetX;c=a.offsetY}if(t&&o==getOpponent(p)){a=C(b,c);a!=-1&&w(a)}} function w(a){var b=(a-1)%3,c=Math.floor((a-1)/3);if(q[c][b]==-1){q[c][b]=o;u=false;g.clearRect(0,0,f.width,f.height);if(o==1){o=0;b=D(a,1);c=D(a,2);var e=D(a,3);a=D(a,4);d.lineWidth=j;d.fillStyle="#FFFFFF";d.strokeStyle="#FFFFFF";d.beginPath();d.moveTo(b+20,c+20);d.lineTo(e-20,a-20);d.moveTo(b+20,a-20);d.lineTo(e-20,c+20);d.stroke();d.closePath()}else{o=1;e=D(a,1);b=D(a,2);var h=D(a,3),s=D(a,4);a=20;c=(h-e)/2;c-=a;e=e+(h-e)/2;b=b+(s-b)/2;a=10;c-=a;d.lineWidth=j;d.fillStyle="#FFFFFF";d.strokeStyle= "#FFFFFF";d.beginPath();d.arc(e,b,c,0,Math.PI*2,true);d.closePath();d.stroke()}if(gameOver(q)){B(E());t=false}else x()}}function E(){if(checkWin(q,1)){if(getOpponent(p)==1)return"Congrats you won!!!";return"Sorry the computer won."}if(checkWin(q,0)){if(getOpponent(p)==0)return"Congrats you won!!!";return"Sorry the computer won."}return"The Game was Drawn"}function x(){if(t)if(o==p){B("Computer turns to play");u?w(5):v.postMessage(A(q,p))}else B("Your turn to play")} function D(a,b){var c=(a-1)%3,e=m*c+l,h=e+m;c=m*((a-(c+1))/3)+i;var s=c+m;return b==1?e:b==2?c:b==3?h:s}function C(a,b){for(var c=1;c<10;c++){var e;a:{e=D(c,1);var h=D(c,2),s=D(c,3),F=D(c,4);if(a>=e&&a<=s)if(b>=h&&b<=F){e=true;break a}e=false}if(e)return c}return-1};